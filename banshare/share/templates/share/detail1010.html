<!--
  detail1010(เท้าแชร์ยกหัวรับตามมือจอง)  
  admin_frist=true
  admin_last=false
  queue=true
  bit=false
-->
{% extends 'share/nav.html' %}

{% block content %}

<h2>{{share.name}}</h2>
<em id='description'></em>
<script>
  document.getElementById('description').innerHTML="{{shareDescription}}";
</script>
<em>วันที่เริ่ม {{share.date_run}}</em>
<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">id</th>
      <th scope="col">name</th>
      <th scope="col">date</th>
      <th scope="col">payment</th>
      <th scope="col">pay_interest</th>
      <th scope="col">capital</th>
      <th scope="col">interest</th>
      <th scope="col">recieve</th>
      <th scope="col">pay_totle</th>
      <th scope="col">balance</th>
    </tr>
  </thead>
  <tbody>
    <script>
      var currentDate = Date.now();
      //currentDate.setDate(currentDate.getDate() + 1);     
      var receiveDate = new Date("{{share.date_run}}");
      var interestDate = new Date("{{share.date_run}}");
      interestDate.setDate(interestDate.getDate() + 7);
      var receiveDateText;
      var interest = 0;
      var recieve;
      var pay_totle;
      var balance;
      var bal = {{share.capital}};
      var noInterest = 1;
      var months = [",Jan,", ",Feb,", ",Mar,", ",Apr,", ",May,", ",Jun,", ",Jul,", ",Aug,", ",Sept,", ",Oct,", ",Nov,", ",Dec,"];
      function receiveDateText(date) {
        text = date.getDate().toString() + months[date.getMonth()] + date.getFullYear().toString();
        return text;
      }           
    </script>

    {%  for customer in share.share_groups_customers_set.all%}
    <tr>
      <th scope="row">{{customer.receive_queue}}</th>
      <td>{{customer.customer}}</td>
      <td id="{{customer.receive_queue}}"></td>
      <script>
        document.getElementById("{{customer.receive_queue}}").innerHTML = receiveDateText(receiveDate);
        
      </script>
      <!--แสดงส่วนของท้าว-->
      {% if customer.receive_queue == 1 %}
      <td>0</td>
      <td>0</td>
      <td>{{share.capital}}</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>{{share.capital}}</td>
      <!--แสดงส่วนของลูกแชร์-->
      {% else %}
      <td>{{share.payment}}</td>
      <td id="pay_interest{{customer.receive_queue}}"></td>
        <!--ลูกแชร์จ่ายดอกหลังจากรับ-->
        <script>
          //if (interestDate < currentDate) {
            document.getElementById("pay_interest{{customer.receive_queue}}").innerHTML = {{ share.interest }};
            
          //}
          
        </script>
      <td id="capital{{customer.receive_queue}}"></td>
        <!--ลูกแชร์ถึงวันรับให้แสดงเงินต้น-->
        <script>
          //if (receiveDate < currentDate) {
            document.getElementById("capital{{customer.receive_queue}}").innerHTML = {{ share.capital }};
            
          //}
          
        </script>
      <td id="interest{{customer.receive_queue}}"></td>
        <script>
          //if(receiveDate < currentDate){
            document.getElementById('interest{{customer.receive_queue}}').innerHTML = interest;
            
          //}
        </script>
      <td id="recieve{{customer.receive_queue}}"></td>
        <script>
          recieve = {{share.capital}} + interest;
          document.getElementById("recieve{{customer.receive_queue}}").innerHTML = recieve;          
        </script>
      <td id="pay_totle{{customer.receive_queue}}"></td>
        <script>
          pay_totle = ({{share.payment}} * {{share.quantity}}) + ({{share.interest}} * ({{share.quantity}} - noInterest));
          document.getElementById("pay_totle{{customer.receive_queue}}").innerHTML = pay_totle;
        </script>
      <td id="balance{{customer.receive_queue}}"></td>
        <script>
          balance = recieve - pay_totle;
          document.getElementById("balance{{customer.receive_queue}}").innerHTML = balance;
          bal += balance;
          //console.log(bal);
        </script>
      <script>
        interest = interest + {{ share.interest }};
      </script>
      {% endif %}
    </tr>
    
    <script>      
      noInterest = noInterest + 1;
      interestDate.setDate(interestDate.getDate()+7);
      receiveDate.setDate(receiveDate.getDate()+7);
    </script>
    {% endfor %}


  </tbody>
</table>
{% endblock %}